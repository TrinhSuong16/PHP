/*=========================================================================================
    File Name: shortkey.min.js
    Description: Shortkey Table
    --------------------------------------------------------------------------------------
    Item Name: Vuexy  - Vuejs, HTML & Laravel Admin Dashboard Template
    Author: Lê Chí Đại
    Author Email: dai.le@southtelecom.vn
==========================================================================================*/
function changeDestination(e,t=""){["pickup","listen","whisper","barge","DND"].includes(e)?($("#details").html('<input type="hidden" name="details" value="" />'),$("#details").parent().parent().hide()):($("#details").closest("div.form-group").removeClass("error"),$("#details").parent().parent().find(".help-block").remove(),$("#details").parent().parent().show(),$.ajax({url:base_url+"settings/shortkey/destination/"+e,type:"GET",dataType:"json",success:function(e){if(1==e.status){let a="<select class='form-control' name='details'>";e.data.forEach(function(e){t!==e.id?a+="<option value='"+e.id+"'>"+e.name+"</option>":a+="<option value='"+e.id+"' selected>"+e.name+"</option>"}),a+="</select>",$("#details").html(a),$("#details>select").select2({dropdownAutoWidth:!0,width:"100%"})}},error:function(e){console.log(e)}}))}function activeSidebar(e=!1){$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show"),$(".cancel-data-btn, .overlay-bg").on("click",function(){$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html("")}),$('input[type="text"], input[type="number"]').keypress(function(e){$(this).closest("div.form-group").removeClass("error"),$(this).parent().parent().find(".help-block").remove()}),$("#destination").select2({dropdownAutoWidth:!0,width:"100%",minimumResultsForSearch:1/0}),0!=e&&"off"!==e.formData.destination&&"phone"!==e.formData.details?changeDestination(e.formData.destination,e.formData.details):changeDestination("internal"),$("#destination").on("change",function(){let e=$(this).val();changeDestination(e)}),$("#frmSubmit").on("click",function(){let e=this;$(e).attr({disabled:"disabled"}).append(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');let t=$("#frm_shortkey").serializeObject(),a=base_url+(void 0===t.id?"settings/shortkey/add":"settings/shortkey/update");$.post(a,t,function(t,a){if($(e).removeAttr("disabled"),$(".spinner-border").remove(),"success"===a)switch(t.status){case 1:$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html(""),document.body.style.overflow="visible",$("#grid").data("kendoGrid").dataSource.read(),toastr.success(t.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500});break;case-1:if(void 0!==t.field){let e=t.field,a='<div class="help-block"><ul role="alert"><li>'+t.message+"</li></ul></div>";e.split(",").forEach(e=>{let t=$("#"+e).closest("div.form-group");t.hasClass("error")?$("#"+e).parent().parent().find(".help-block").remove():t.addClass("error"),$("#"+e).parent().after(a)})}default:toastr.warning(t.message,"Warning!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2e3})}else toastr.error(t.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})}),$(".data-items").length>0&&new PerfectScrollbar(".data-items",{wheelPropagation:!1})}pbx.init(),$("#add-shortkey").on("click",function(){var e=kendo.template($("#addnewTemplate").html());$("#add-new-data-sidebar").html(e),setTimeout(activeSidebar,200)}),$(document).ready(function(){var e=$("#windowConfirm").kendoWindow({title:"",visible:!1,width:"400px"}).data("kendoWindow"),t=$("#grid").kendoGrid({dataSource:{transport:{read:{url:base_url+"settings/shortkey/lists",contentType:"application/json",type:"GET"},parameterMap:function(e,t){if("read"!==t&&e){let t=$("meta[name=csrf]").attr("content").split(":");e[[t[0]]]=t[1]}return e}},schema:{data:"data",total:"total"},page:1,pageSize:20,serverPaging:!0,serverFiltering:!0,serverSorting:!0,change:function(e){idx=this.skip()+1,$.each(this.data(),(e,t)=>{t.no=idx,idx++})}},sortable:!1,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},filterable:{extra:!1,mode:"row",operators:{string:{contains:controlsKendo.grid.filter.operators.contains,eq:controlsKendo.grid.filter.operators.eq,neq:controlsKendo.grid.filter.operators.neq}}},noRecords:!0,scrollable:!0,columns:[{field:"no",title:controlsKendo.grid.column.title.no,filterable:!1,width:70,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"short_key",title:controlsKendo.grid.column.title.short_key,width:170,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"destinatype_name",title:controlsKendo.grid.column.title.destinatype,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"destination_name",title:controlsKendo.grid.column.title.destination,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"created_date",title:controlsKendo.grid.column.title.created_date,width:170,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{attributes:{class:"table-cell",style:"text-align: center;"},command:[{name:"edit",template:kendo.template($("#gridActionEditTemplate").html()),click(e){e.preventDefault();var t=$(e.target).closest("tr"),a={formData:this.dataItem(t)},s=kendo.template($("#addnewTemplate").html())(a);$("#add-new-data-sidebar").html(s),setTimeout(async function(){activeSidebar(a)},200)}},{name:"delete",template:kendo.template($("#gridActionDeleteTemplate").html()),click(a){a.preventDefault();var s=kendo.template($("#windowConfirmTemplate").html()),o=$(a.target).closest("tr");let i=this.dataItem(o);var l=s({formData:i});e.title($("#windowConfirmTemplate").attr("title")),e.content(l),e.center().open(),$(".k-button-no").click(function(){e.close()}),$(".k-button-yes").click(function(){e.close(),kendo.ui.progress(t.element,!0);let a=$("meta[name=csrf]").attr("content").split(":"),s={[a[0]]:a[1],id:i.id,short_key:i.short_key,customer_code:i.customer_code};$.post(base_url+"settings/shortkey/destroy",s,function(e,a){kendo.ui.progress(t.element,!1),"success"===a&&e.status?(t.dataSource.remove(i),t.dataSource.sync(),toastr.success(e.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500})):toastr.error(e.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})})}}],title:"&nbsp;",width:160}]}).data("kendoGrid")});