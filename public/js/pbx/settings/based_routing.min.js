/*=========================================================================================
    File Name: based_routing.min.js
    Description: Based routing Table
    --------------------------------------------------------------------------------------
    Item Name: Vuexy  - Vuejs, HTML & Laravel Admin Dashboard Template
    Author: Lê Chí Đại
    Author Email: dai.le@southtelecom.vn
==========================================================================================*/
function changeDestination(e,t=""){$("#default_id").closest("div.form-group").removeClass("error"),$("#default_id").parent().parent().find(".help-block").remove(),$("#default_id").parent().show(),$.ajax({url:base_url+"settings/based_routing/destination/"+e,type:"GET",dataType:"json",success:function(e){if(1==e.status){let s="<select class='select2-theme form-control' name='default_id'>";e.data.forEach(function(e){t!==e.id?s+="<option value='"+e.id+"'>"+e.name+"</option>":s+="<option value='"+e.id+"' selected>"+e.name+"</option>"}),s+="</select>",$("#default_id").html(s),$(".select2-theme").select2({dropdownAutoWidth:!0,width:"100%"})}},error:function(e){console.log(e)}})}function activeSidebar(e=!1){$(".select2-theme").select2({dropdownAutoWidth:!0,width:"100%"}),$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show"),$(".cancel-data-btn, .overlay-bg").on("click",function(){$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html("")}),$('input[type="text"], input[type="number"]').keypress(function(e){$(this).closest("div.form-group").removeClass("error"),$(this).parent().parent().find(".help-block").remove()}),$(".select2-theme").on("change",function(){$(this).closest("div.form-group").removeClass("error"),$(this).parent().parent().find(".help-block").remove()}),0!=e&&"off"!==e.formData.default_type&&"phone"!==e.formData.default_type?changeDestination(e.formData.default_type,e.formData.default_id):changeDestination("internal"),$("#default_type").on("change",function(){let e=$(this).val();changeDestination(e)}),$("#frmSubmit").on("click",function(){let e=this;$(e).attr({disabled:"disabled"}).append(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');let t=$("#frm_based_routing").serializeObject(),s=base_url+(void 0===t.id?"settings/based_routing/add":"settings/based_routing/update");$.post(s,t,function(t,s){if($(e).removeAttr("disabled"),$(".spinner-border").remove(),"success"===s)switch(t.status){case 1:$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html(""),document.body.style.overflow="visible",$("#grid").data("kendoGrid").dataSource.read(),toastr.success(t.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500});break;case-1:if(void 0!==t.field){let e=t.field,s='<div class="help-block"><ul role="alert"><li>'+t.message+"</li></ul></div>";e.split(",").forEach(e=>{let t=$("#"+e).closest("div.form-group");t.hasClass("error")?$("#"+e).parent().parent().find(".help-block").remove():t.addClass("error"),$("#"+e).parent().after(s)})}default:toastr.warning(t.message,"Warning!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2e3})}else toastr.error(t.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})}),$(".data-items").length>0&&new PerfectScrollbar(".data-items",{wheelPropagation:!1})}pbx.init(),$("#add-based_routing").on("click",function(){var e=kendo.template($("#addnewTemplate").html());$("#add-new-data-sidebar").html(e),setTimeout(activeSidebar,200)}),$("#sync_config").on("click",function(){$("#sync_config").attr({disabled:"disabled"}).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="sr-only">Loading...</span>');let e=$("meta[name=csrf]").attr("content").split(":"),t={[e[0]]:e[1]};$.post(base_url+"settings/based_routing/sync_config",t,function(e,t){"success"===t&&e.status?toastr.success(e.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2e3}):toastr.error(e.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3}),$("#sync_config").removeAttr("disabled").html('<i class="feather icon-save"></i>')})}),$(document).ready(function(){var e=$("#windowConfirm").kendoWindow({title:"",visible:!1,width:"400px"}).data("kendoWindow"),t=$("#grid").kendoGrid({dataSource:{transport:{read:{url:base_url+"settings/based_routing/lists",contentType:"application/json",type:"GET"},parameterMap:function(e,t){if("read"!==t&&e){let t=$("meta[name=csrf]").attr("content").split(":");e[[t[0]]]=t[1]}return e}},schema:{data:"data",total:"total"},page:1,pageSize:20,serverPaging:!0,serverFiltering:!0,serverSorting:!0,change:function(e){idx=this.skip()+1,$.each(this.data(),(e,t)=>{t.no=idx,idx++})}},sortable:!1,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},filterable:{extra:!1,mode:"row",operators:{string:{contains:controlsKendo.grid.filter.operators.contains,eq:controlsKendo.grid.filter.operators.eq,neq:controlsKendo.grid.filter.operators.neq}}},noRecords:!0,scrollable:!0,columns:[{field:"no",title:controlsKendo.grid.column.title.no,filterable:!1,width:70,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"name",title:controlsKendo.grid.column.title.name,width:250,headerAttributes:{class:"table-header-cell",style:"font-size: 14px"},attributes:{class:"table-cell"}},{field:"rout_url",title:controlsKendo.grid.column.title.rout_url,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell"}},{field:"secret",title:controlsKendo.grid.column.title.secret,width:300,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{attributes:{class:"table-cell",style:"text-align: center;"},command:[{name:"edit",template:kendo.template($("#gridActionEditTemplate").html()),click(e){e.preventDefault();var t=$(e.target).closest("tr"),s={formData:this.dataItem(t)},a=kendo.template($("#addnewTemplate").html())(s);$("#add-new-data-sidebar").html(a),setTimeout(function(){activeSidebar(s)},200)}},{name:"delete",template:kendo.template($("#gridActionDeleteTemplate").html()),click(s){s.preventDefault();var a=kendo.template($("#windowConfirmTemplate").html()),o=$(s.target).closest("tr");let i=this.dataItem(o);var n=a({formData:i});e.title($("#windowConfirmTemplate").attr("title")),e.content(n),e.center().open(),$(".k-button-no").click(function(){e.close()}),$(".k-button-yes").click(function(){e.close(),kendo.ui.progress(t.element,!0);let s=$("meta[name=csrf]").attr("content").split(":"),a={[s[0]]:s[1],id:i.id,name:i.name,customer_code:i.customer_code};$.post(base_url+"settings/based_routing/destroy",a,function(e,s){kendo.ui.progress(t.element,!1),"success"===s&&e.status?(t.dataSource.remove(i),t.dataSource.sync(),toastr.success(e.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500})):toastr.error(e.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})})}}],title:"&nbsp;",width:160}]}).data("kendoGrid")});