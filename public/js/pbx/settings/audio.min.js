/*=========================================================================================
    File Name: audio.min.js
    Description: Queues Table
    --------------------------------------------------------------------------------------
    Item Name: Vuexy  - Vuejs, HTML & Laravel Admin Dashboard Template
    Author: Lê Chí Đại
    Author Email: dai.le@southtelecom.vn
==========================================================================================*/
function activeSidebar(e=!1){$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show"),$(".cancel-data-btn, .overlay-bg").on("click",function(){$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html("")}),$('input[type="text"], input[type="number"]').keypress(function(e){$(this).closest("div.form-group").removeClass("error"),$(this).parent().parent().find(".help-block").remove()}),Dropzone.autoDiscover=!1,$("#myDropzone").dropzone({url:base_url+"settings/audio/upload",acceptedFiles:".wav, .mp3",maxFileSize:5,maxFiles:10,autoDiscover:!1,autoProcessQueue:!1,parallelUploads:100,uploadMultiple:!0,addRemoveLinks:!0,paramName:"audio",init:function(){var e=document.querySelector("#dropzoneSubmit");myDropzone=this,e.addEventListener("click",function(e){0===myDropzone.getQueuedFiles().length?toastr.error(controlsKendo.valiation.audio_is_required,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2500}):(myDropzone.processQueue(),$("#dropzoneSubmit").attr({disabled:"disabled"}).append(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'))}),this.on("sendingmultiple",function(e,t,a){let o=$("meta[name=csrf]").attr("content").split(":");a.append([o[0]],o[1])}),this.on("successmultiple",function(e,t){$("#dropzoneSubmit").removeAttr("disabled"),$(".spinner-border").remove();let a=t.csrf.name,o=t.csrf.value;document.querySelector('meta[name="csrf"]').setAttribute("content",a+":"+o),$(document).find('input[type="hidden"]').filter('[name="'+a+'"]').val(o),$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html(""),document.body.style.overflow="visible",$("#grid").data("kendoGrid").dataSource.read(),Swal.fire({title:"OK!",html:t.message,type:"success",confirmButtonClass:"btn btn-success",buttonsStyling:!1})}),this.on("error",function(e,t){toastr.error(response.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2500})})}}),$(".data-items").length>0&&new PerfectScrollbar(".data-items",{wheelPropagation:!1})}pbx.init(),$("#add-audio").on("click",function(){var e=kendo.template($("#addnewTemplate").html());$("#add-new-data-sidebar").html(e),setTimeout(activeSidebar,200)}),$(document).ready(function(){var e=$("#windowConfirm").kendoWindow({title:"",visible:!1,width:"400px"}).data("kendoWindow"),t=$("#grid").kendoGrid({dataSource:{transport:{read:{url:base_url+"settings/audio/lists",contentType:"application/json",type:"GET"}},schema:{data:"data",total:"total"},page:1,pageSize:20,serverPaging:!0,serverFiltering:!0,serverSorting:!0,change:function(e){idx=this.skip()+1,$.each(this.data(),(e,t)=>{t.no=idx,idx++})}},filterable:!1,sortable:!1,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},columns:[{field:"no",title:controlsKendo.grid.column.title.no,width:70,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"filename",title:controlsKendo.grid.column.title.filename},{field:"filetype",title:controlsKendo.grid.column.title.filetype,width:120,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"created_date",title:controlsKendo.grid.column.title.created_date,width:170,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{attributes:{class:"table-cell",style:"text-align: center;"},command:[{name:"media",template:kendo.template($("#gridActionPlayRecordTemplate").html()),click(e){e.preventDefault();let t=$(e.target).closest("tr"),a=this.dataItem(t),o=$("#play_record_audio").kendoWindow({title:a.filename,visible:!1,resizable:!1,width:"500px",close:function(){$(this.element).empty()}}).data("kendoWindow"),i=kendo.template($("#play-audio").html())({data:a});o.content(i),o.center().open()}},{name:"download",template:kendo.template($("#gridActionDownloadTemplate").html()),click(e){e.preventDefault();let t=$(e.target).closest("tr"),a=this.dataItem(t);window.top.location=`${base_url}settings/audio/download?id=${a.id}&customer_code=${a.customer_code}&file=${a.filepath}/${a.filename}.${a.filetype}`}},{name:"delete",template:kendo.template($("#gridActionDeleteTemplate").html()),click(a){a.preventDefault();let o=kendo.template($("#windowConfirmTemplate").html()),i=$(a.target).closest("tr"),l=this.dataItem(i),n=o({formData:l});e.title($("#windowConfirmTemplate").attr("title")),e.content(n),e.center().open(),$(".k-button-no").click(function(){e.close()}),$(".k-button-yes").click(function(){e.close();let a=$("meta[name=csrf]").attr("content").split(":"),o={[a[0]]:a[1],id:l.id,filename:l.filename,customer_code:l.customer_code};$.post(base_url+"settings/audio/destroy",o,function(e,a){"success"===a&&e.status?(t.dataSource.remove(l),t.dataSource.sync(),toastr.success(e.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500})):toastr.error(e.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})})}}],title:"&nbsp;",width:150}]}).data("kendoGrid")});