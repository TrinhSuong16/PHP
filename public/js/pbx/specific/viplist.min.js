/*=========================================================================================
    File Name: viplist.min.js
    Description: Viplist Table
    --------------------------------------------------------------------------------------
    Item Name: Vuexy  - Vuejs, HTML & Laravel Admin Dashboard Template
    Author: Lê Chí Đại
    Author Email: dai.le@southtelecom.vn
==========================================================================================*/
function changeDestination(e,t=""){$("#destination").closest("div.form-group").removeClass("error"),$("#destination").parent().parent().find(".help-block").remove(),$("#destination").parent().show(),$.ajax({url:base_url+"specific/viplist/destination/"+e,type:"GET",dataType:"json",success:function(e){if(1==e.status){let a="<select class='form-control' name='destination'>";e.data.forEach(function(e){t!==e.id?a+="<option value='"+e.id+"'>"+e.name+"</option>":a+="<option value='"+e.id+"' selected>"+e.name+"</option>"}),a+="</select>",$("#destination").html(a),$("select[name=destination]").select2({dropdownAutoWidth:!0,width:"100%"})}},error:function(e){console.log(e)}})}function activeSidebar(e=!1){$(".add-new-data").addClass("show"),$(".overlay-bg").addClass("show"),$(".cancel-data-btn, .overlay-bg").on("click",function(){$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html("")}),$('input[type="text"], input[type="number"]').keypress(function(e){$(this).closest("div.form-group").removeClass("error"),$(this).parent().parent().find(".help-block").remove()}),0!=e&&"off"!==e.formData.destinatype&&"phone"!==e.formData.destinatype?changeDestination(e.formData.destinatype,e.formData.destination):changeDestination("internal"),$("#destinatype,#group").select2({dropdownAutoWidth:!0,width:"100%",minimumResultsForSearch:1/0}),$("#destinatype").on("change",function(){let e=$(this).val();changeDestination(e)}),$("#frmSubmit").on("click",function(){let e=this;$(e).attr({disabled:"disabled"}).append(' <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>');let t=$("#frm_viplist").serializeObject(),a=base_url+(void 0===t.id?"specific/viplist/add":"specific/viplist/update");$.post(a,t,function(t,a){if($(e).removeAttr("disabled"),$(".spinner-border").remove(),"success"===a)switch(t.status){case 1:$(".add-new-data").removeClass("show"),$(".overlay-bg").removeClass("show"),$("#add-new-data-sidebar").html(""),document.body.style.overflow="visible",$("#grid").data("kendoGrid").dataSource.read(),toastr.success(t.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500});break;case-1:if(void 0!==t.field){let e=t.field,a='<div class="help-block"><ul role="alert"><li>'+t.message+"</li></ul></div>";e.split(",").forEach(e=>{let t=$("#"+e).closest("div.form-group");t.hasClass("error")?$("#"+e).parent().parent().find(".help-block").remove():t.addClass("error"),$("#"+e).parent().after(a)})}default:toastr.warning(t.message,"Warning!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:2e3})}else toastr.error(t.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})}),$(".data-items").length>0&&new PerfectScrollbar(".data-items",{wheelPropagation:!1})}pbx.init(),$("#add-viplist").on("click",function(){var e=kendo.template($("#addnewTemplate").html());$("#add-new-data-sidebar").html(e),setTimeout(activeSidebar,200)}),$(document).ready(function(){var e=$("#windowConfirm").kendoWindow({title:"",visible:!1,width:"400px"}).data("kendoWindow"),t=$("#grid").kendoGrid({dataSource:{transport:{read:{url:base_url+"specific/viplist/lists",contentType:"application/json",type:"GET"},parameterMap:function(e,t){if("read"!==t&&e){let t=$("meta[name=csrf]").attr("content").split(":");e[[t[0]]]=t[1]}return null!=e.filter&&e.filter.filters.forEach(function(e){console.log(e),"viplist_groupname"===e.field&&(e.field="group")}),e}},schema:{data:"data",total:"total"},page:1,pageSize:20,serverPaging:!0,serverFiltering:!0,serverSorting:!0,change:function(e){idx=this.skip()+1,$.each(this.data(),(e,t)=>{t.no=idx,idx++})}},sortable:!1,pageable:{refresh:!0,pageSizes:!0,buttonCount:5},filterable:{extra:!1,mode:"row",operators:{string:{contains:controlsKendo.grid.filter.operators.contains,eq:controlsKendo.grid.filter.operators.eq,neq:controlsKendo.grid.filter.operators.neq}}},noRecords:!0,scrollable:!0,columns:[{field:"no",title:controlsKendo.grid.column.title.no,filterable:!1,width:70,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"number",title:controlsKendo.grid.column.title.number,width:170,headerAttributes:{class:"table-header-cell",style:"font-size: 14px"},attributes:{class:"table-cell"}},{field:"status",title:controlsKendo.grid.column.title.status,width:130,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"},filterable:{cell:{showOperators:!1,template:function(e){e.element.kendoDropDownList({dataSource:[{id:"1",text:controlsKendo.grid.filter.value.enable},{id:"0",text:controlsKendo.grid.filter.value.disable}],filter:"startswith",optionLabel:"--Select--",dataTextField:"text",dataValueField:"id",valuePrimitive:!0})}}},template:function(e){return 1==e.status?'<button class="btn-icon btn btn-primary btn-round btn-sm" type="button" data-toggle="tooltip" data-placement="top" data-original-title="In Use"><i class="feather icon-user-check"></i></button>':'<button class="btn-icon btn rounded-circle btn-sm btn-outline-primary" type="button" data-toggle="tooltip" data-placement="top" data-original-title="Not in use"><i class="feather icon-user"></i></button>'}},{field:"destinatype_name",title:controlsKendo.grid.column.title.destinatype,width:120,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"destination_name",title:controlsKendo.grid.column.title.destination,width:120,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"viplist_groupname",title:controlsKendo.grid.column.title.group,width:140,filterable:{cell:{showOperators:!1,template:function(e){e.element.kendoDropDownList({dataSource:{serverFiltering:!0,transport:{read:{url:base_url+"specific/viplist/groups",contentType:"application/json",type:"GET"}},schema:{data:"data",total:"total"}},optionLabel:"--Select--",dataTextField:"viplist_groupname",dataValueField:"id",valuePrimitive:!0})}}},headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{field:"note",title:controlsKendo.grid.column.title.note},{field:"cretime",title:controlsKendo.grid.column.title.cretime,width:170,filterable:!1,headerAttributes:{class:"table-header-cell",style:"text-align: center; font-size: 14px"},attributes:{class:"table-cell",style:"text-align: center;"}},{attributes:{class:"table-cell",style:"text-align: center;"},command:[{name:"edit",template:kendo.template($("#gridActionEditTemplate").html()),click(e){e.preventDefault();var t=$(e.target).closest("tr"),a={formData:this.dataItem(t)},i=kendo.template($("#addnewTemplate").html())(a);$("#add-new-data-sidebar").html(i),setTimeout(async function(){activeSidebar(a)},200)}},{name:"delete",template:kendo.template($("#gridActionDeleteTemplate").html()),click(a){a.preventDefault();var i=kendo.template($("#windowConfirmTemplate").html()),l=$(a.target).closest("tr");let o=this.dataItem(l);var s=i({formData:o});e.title($("#windowConfirmTemplate").attr("title")),e.content(s),e.center().open(),$(".k-button-no").click(function(){e.close()}),$(".k-button-yes").click(function(){e.close(),kendo.ui.progress(t.element,!0);let a=$("meta[name=csrf]").attr("content").split(":"),i={[a[0]]:a[1],id:o.id,number:o.number,customer_code:o.customer_code};$.post(base_url+"specific/viplist/destroy",i,function(e,a){kendo.ui.progress(t.element,!1),"success"===a&&e.status?(t.dataSource.remove(o),t.dataSource.sync(),toastr.success(e.message,"Success!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:1500})):toastr.error(e.message,"Error!",{positionClass:"toast-top-left",containerId:"toast-top-left",showMethod:"slideDown",hideMethod:"slideUp",timeOut:3e3})})})}}],title:"&nbsp;",width:160}]}).data("kendoGrid")});